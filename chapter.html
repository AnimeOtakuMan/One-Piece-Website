<!DOCTYPE html>

<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/jpg" href="favicon.jpg">
    <title>One Piece Chapter</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <meta name="description" content="Read Latest One Piece chapter latest" />
    <meta name="robots" content="index, follow" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RTV0J12CLR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-RTV0J12CLR');
    </script>
    <script data-ad-client="ca-pub-5483591282248570" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>

    <style>
        body {
            background-color: black;
        }

        iframe {
            position: absolute;
            top: 0;
            left: 10%;
        }

        #pageList {
            position: relative;
            padding-top: 260px;
            padding-bottom: 250px;
        }

        #title {
            color: white;
            text-align: center;
        }

        .leftButton {
            position: relative;
            right: 20%;
        }

        .rightButton {
            position: relative;
            left: 20%;
        }

        #footer {
            text-align: center;
            position: relative;
            bottom: 0%;
        }
    </style>

<nav class="navbar navbar-light customNavbar">
    <a class="navbar-brand" style="color: white; font-weight: bolder;" href="https://lifeofluffy.com/">
        <img src="favicon.jpg" width="50" height="50" alt="">
        One Piece Manga
    </a>
</nav>

    <div id="title"></div>
    <div class="container" id="pageList"></div>

    <div id="footer"></div>

    <script>
        let requestURL = 'https://raw.githubusercontent.com/AnimeOtakuMan/One-Piece-Chapters-Json/master/chapter_json.json';

        let request = new XMLHttpRequest();
        request.open('GET', requestURL);

        request.responseType = 'json';
        request.send();

        request.onload = function () {
            var chapterNumber = getQueryVariable("chapter");
            chapterNumber = chapterNumber.replaceAll("%20", " ");
            document.title = chapterNumber;

            var headingElement = document.createElement("h2");
            headingElement.innerHTML = chapterNumber;
            var titleDiv = document.getElementById("title");
            titleDiv.appendChild(headingElement);

            const chapters = request.response;
            var currentChapter = null;
            var latestChapter = true;
            //Find out if current chapter is latest chapter
            for (let chapter of chapters) {
                if (chapter['chapter_number'] == chapterNumber) {
                    currentChapter = chapter;
                    break;
                }
                else {
                    latestChapter = false;
                }
            }

            let nextChapterNumber = "chapter.html?chapter=";
            let prevChapterNumber = "chapter.html?chapter=";
            //Find out next chapter URL and prev chapter URL
            for (var i = 0; i < chapters.length; i++) {
                if (chapters[i]['chapter_number'] == chapterNumber) {
                    currentChapter = chapters[i];
                    if (i != 0) {
                        nextChapterNumber += chapters[i - 1]['chapter_number'];
                    }
                    if (i != chapters.length - 1) {
                        prevChapterNumber += chapters[i + 1]['chapter_number'];
                    }
                    break;
                }
                else {
                    latestChapter = false;
                }
            }

            console.log("Prev: " + prevChapterNumber);
            console.log("Next: " + nextChapterNumber);

            var prevChapterButton = document.createElement("a");
            prevChapterButton.setAttribute("class", "leftButton");
            var nextChapterButton = document.createElement("a");
            nextChapterButton.setAttribute("class", "rightButton");

            prevChapterButton.setAttribute("href", prevChapterNumber);
            nextChapterButton.setAttribute("href", nextChapterNumber);

            prevChapterButton.innerHTML = "Previous Chapter"
            nextChapterButton.innerHTML = "Next Chapter"

            var footerDiv = document.getElementById("footer");
            titleDiv.appendChild(prevChapterButton);
            footerDiv.appendChild(prevChapterButton.cloneNode(true));
            if (!latestChapter) {
                titleDiv.appendChild(nextChapterButton);
                footerDiv.appendChild(nextChapterButton.cloneNode(true));
            }

            const imageURLs = currentChapter['image_urls'];
            var pageList = document.getElementById("pageList");
            imageURLs.forEach(element => {
                var pageImage = document.createElement("img");
                var pageDiv = document.createElement("div");
                pageDiv.setAttribute("class", "d-flex justify-content-center");

                pageImage.setAttribute("src", element);
                pageImage.setAttribute("class", "img-fluid");
                pageImage.setAttribute("alt", "One Piece Chapter " + chapterNumber);

                pageDiv.appendChild(pageImage);
                pageList.appendChild(pageDiv);
            });
        };


        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) { return pair[1]; }
            }
            return (false);
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script>
        (function (__htas) {
            var d = document,
                s = d.createElement('script'),
                l = d.scripts[d.scripts.length - 1];
            s.settings = __htas || {};
            s.src = "\/\/apprefaculty.pro\/aBWbZ.yOQY2\/9fklZ\/Tx9V6\/bI2F5dlKS\/WUQv9UNvDuEw2CNKT\/Y_4cNziN0c0\/MGTpYS1RN\/jYgd3qJ-ndBD1\/ck2shcalby2i5dlhSWWAQl9\/NHDuEY2hNETxYP4XNNiT0\/0wMcT\/Yw1\/NcjQgR3L";
            l.parentNode.insertBefore(s, l);
        })({})
    </script>
</body>

</html>